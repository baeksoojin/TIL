## 스프링부트와 외부설정과 프로필

## 외부설정

하나의 애플리케이션을 여러 다른 환경에서 사용해야할 때가 있다. 

- 개발환경 : 개발 서버, 개발 DB 사용
- 운영환경 : 운영 서버, 운영 DB 사용

각각의 환경에서는 서로 다른 설정값이 존재한다. DB가 다르다면 서로 다른 ip 혹은 url을 사용해야할 것이다.

이때, 다른 설정값을 다른 환경에서 어떻게 처리할 수 있을까? 외부설정을 이용하자.

### 외부설정 방법이란?

> 애플리케이션을 실행할 때 필요한 설정값을 외부에서 불러와서 애플리케이션에 전달하는 설정방법을 의미한다.
> 

- 내부설정 방법 : 예전에는 각 서버별로 빌드를 따로 진행하여 따로 배포하였다.

환경에 따라 변하는 설정값을 내부에 포함해서 개발용, 운영용을 따로 build하고 이후 따로 배포를 하게 된다. 이렇게 된다면 각 환경별로 여러번 빌드를 해야할뿐만 아니라 개발 버전과 운영 버전의 빌드 결과물이 다를 수 밖에 없기에 개발 환경에서 검증이 되었어도 운영 환경에서 예측불가한 문제가 발생할 수 있다.

- 외부설정 방법 : 빌드를 한번만 하고 각 환경에 맞춰서  실행 시점에 외부에서 설정값을 주입한다.

따라서 빌드를 한번만 사용하게 돼서 기존의 문제점을 해결할 수 있을 뿐만 아니라 새로운 환경이 추가되어도 쉽게 새로운 환경을 추가할 수 있다.

> 변하는 것과 변하지 않는 것을 분리하는 것은 유지보수 관점에서의 가장 중요한 기본 원칙이다.
> 

**방식**

OS 환경변수(System.getenv()를 사용)

자바 시스템 속성(System.getProperty()를 사용)

자바 커멘드 라인( 커멘드라인 옵션 인수를 사용하는데 스프링부트를 사용하면 옵션 인수를 주입받고 어디서든 주입한 변수를 사용할 수 있는 기능을 제공)

외부 파일 : 각 서버마다 해당 파일안의 다른 설정 정보를 남겨두고 해당 설정 파일을 읽어와서 환경변수를 주입한다.(프로필을 활용해서 어디에 사용할 파일인지 구분할 수 있음)

## 스프링부트의 외부 설정 통합

![image](https://user-images.githubusercontent.com/74058047/226939122-97b1facb-28ab-463b-b6d6-d90bdf5d2777.png)


- key, value를 통해서 외부 설정값을 읽을 수 있도록 제공
- `Environment`와 `PropertySource` 추상 클래스를 사용하면 되고 각각이 ~~~PropertySource라는 구현체로 제공된다.
- 읽을 때 key를 전달해서 Environment를 통해서 프로퍼티 소스들을 조회하고 값을 조회할 수 있다.